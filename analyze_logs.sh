#!/bin/bash

# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –ª–æ–≥–∞–º–∏
cat <<EOL > access.log
192.168.1.1 - - [28/Jul/2024:12:34:56 +0000] "GET /index.html HTTP/1.1" 200 1234
192.168.1.2 - - [28/Jul/2024:12:35:56 +0000] "POST /login HTTP/1.1" 200 567
192.168.1.3 - - [28/Jul/2024:12:36:56 +0000] "GET /home HTTP/1.1" 404 890
192.168.1.1 - - [28/Jul/2024:12:37:56 +0000] "GET /index.html HTTP/1.1" 200 1234
192.168.1.4 - - [28/Jul/2024:12:38:56 +0000] "GET /about HTTP/1.1" 200 432
192.168.1.2 - - [28/Jul/2024:12:39:56 +0000] "GET /index.html HTTP/1.1" 200 1234
EOL

# –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
total_requests=$(wc -l < access.log)

# –ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP-–∞–¥—Ä–µ—Å–æ–≤ (—Å—Ç—Ä–æ–≥–æ —Å awk)
unique_ips=$(awk '{ips[$1]++} END {print length(ips)}' access.log)

# –ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –º–µ—Ç–æ–¥–∞–º (—Å—Ç—Ä–æ–≥–æ —Å awk)
methods_stats=$(awk '{if ($6 == "\"GET") get_count++; if ($6 == "\"POST") post_count++} END {print "GET:", get_count; print "POST:", post_count}' access.log)

# –ù–∞—Ö–æ–∂–¥–µ–Ω–∏–µ —Å–∞–º–æ–≥–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ–≥–æ URL (—Å—Ç—Ä–æ–≥–æ —Å awk)
popular_url=$(awk '{
    split($7, url, " ");  # –†–∞–∑–¥–µ–ª—è–µ–º URL, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å
    if (url[1] != "") urls[url[1]]++  # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–∂–¥–æ–≥–æ URL
}
END {
    max = 0;
    for (u in urls)  # –ò—â–µ–º —Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π URL
        if (urls[u] > max) {
            max = urls[u];
            popular = u
        }
    print popular, max  # –í—ã–≤–æ–¥–∏–º —Å–∞–º—É—é –ø–æ–ø—É–ª—è—Ä–Ω—É—é —Å—Å—ã–ª–∫—É –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
}' access.log)

# –û—Ç—á–µ—Ç –æ –ª–æ–≥–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
{
    echo "=================================="
    echo "   üìÅ –û—Ç—á–µ—Ç –æ–± –ª–æ–≥–∞—Ö –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞   "
    echo "=================================="
    echo ""
    echo "–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤: $total_requests"
    echo "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP-–∞–¥—Ä–µ—Å–æ–≤: $unique_ips"
    echo ""
    echo "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –º–µ—Ç–æ–¥–∞–º:"
    echo "$methods_stats"
    echo ""
    # –ó–º—ñ–Ω–µ–Ω–æ –≤–∏–≤–µ–¥–µ–Ω–Ω—è –¥–ª—è —Å–∞–º–æ–≥–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ–≥–æ URL
    echo "–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π URL: $(echo $popular_url | awk '{print $2, $1}')"
    echo
    echo "=================================="
} > report.txt
